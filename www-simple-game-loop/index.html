<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Simple Game Loop Example</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">
  <link type="text/css" rel="stylesheet" href="css/site.css">
  <style>
    tr.pressed td {
      background-color: tomato;
    }
  </style>
</head>

<body>
  <div id="content"></div>

  <script type="text/javascript" src="js/site.js"></script>
  <script>
    //------------------------------------------
    // Initialize.
    let htmlContainer = document.getElementById("content")

    //------------------------------------------
    // Game loop.
    let fpsData = {
      timeStamp: 0,
      fps: 0
    };

    let gameData = {};

    // Game loop function to get the user input.
    function processGameInput() {
      // TODO: Get user input.
    }

    // Game loop function to calculate the game data.
    function updateGameData(elapsed) {
      // TODO: Update the game data.
      fpsCalc.update(1000.0 / elapsed);

    }

    // Game loop function to update the page.
    function renderGameView() {
      // Create the page html.
      let html = `
        <h1>Game Loop</h1>
        <table>
          <tr>
            <td>time stamp</td>
            <td>${fpsData.timeStamp}</td>
          </tr>
          <tr>
            <td>fps</td>
            <td>${fpsData.fps}</td>
          </tr>
        </table>
        `;
      htmlContainer.innerHTML = html;
    }

    var previous = 0.0,
      lag = 0.0,
      elapsed = 0.0,
      maxFPS = 100.0,
      timestep = 1000.0 / maxFPS;

    const fpsCalc = new MovingAverageCalculator();
    const lagCalc = new MovingAverageCalculator();

    // The main game loop.
    function gameLoop(current) {
      elapsed = current - previous;

      // If the time elapsed is less than the time step, request another frame.
      // This has the loop wait for the time step.
      if (elapsed < timestep) {
        requestAnimationFrame(gameLoop);
        //updateGameData(elapsed);
        return;
      }

      previous = current;
      lag += elapsed;

      // Get input.
      processGameInput();

      // Update.
      while (lag >= timestep) {
        updateGameData(elapsed);
        lag -= timestep;
      }

      fpsData = {
        timeStamp: current,
        fps: Math.round(fpsCalc.mean),
      };

      // Render.
      renderGameView();
      requestAnimationFrame(gameLoop);
    }

    requestAnimationFrame(gameLoop);
  </script>
</body>

</html>